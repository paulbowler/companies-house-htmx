<% if (analysis) { %>
  <!-- User message -->
  <div class="chat-item-user mb-1">
    <div class="alert alert-primary mb-0"><%= prompt %></div>
  </div>
  <!-- Assistant message -->
  <div class="chat-item-assistant mb-3">
    <div class="assistant-markdown bg-light p-3 border rounded markdown-body"></div>
  </div>
  <script>
    (function() {
      // Render markdown in the last assistant message container
      var containers = document.querySelectorAll('#analysisResponse .chat-item-assistant .assistant-markdown');
      var last = containers[containers.length - 1];
      last.innerHTML = marked.parse(<%- JSON.stringify(analysis) %>);
    })();
  </script>
<% } else { %>
  <div class="chat-item-assistant mb-3">
    <div class="alert alert-danger mb-0">Error generating analysis.</div>
  </div>
<% } %>